<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="CDOWin.Views.Reminders.RemindersPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:CDOWin.Views"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:viewmodels="using:CDOWin.ViewModels" 
    xmlns:models="using:CDO.Core.Models"
    xmlns:reminders="using:CDOWin.Views.Reminders"
    mc:Ignorable="d">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>

        <!-- Header Text -->
        <TextBlock Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2" Margin="8,8,8,4"
                   Style="{StaticResource PageTitleStyle}" Text="Reminders"/>

        <!-- Calendar -->
        <CalendarView Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" Margin="0,6,0,0"
                      x:Name="RemindersCalendar" HorizontalAlignment="Center" SelectionMode="Single"
                      IsGroupLabelVisible="True" IsOutOfScopeEnabled="True" 
                      SelectedDatesChanged="RemindersCalendar_SelectedDatesChanged"
                      CalendarViewDayItemChanging="RemindersCalendar_CalendarViewDayItemChanging"
                      CalendarIdentifier="GregorianCalendar"/>

        <!-- Selection Bar + Calendar View Button: Used to filter our reminders -->
        <SelectorBar Grid.Row="2" Grid.Column="0" x:Name="SelectionBar" SelectionChanged="SelectionChanged">
            <SelectorBarItem Text="All" IsSelected="True" Tag="{x:Bind reminders:RemindersFilter.All}"/>
            <SelectorBarItem Text="Upcoming" Tag="{x:Bind reminders:RemindersFilter.Upcoming}"/>
            <SelectorBarItem Text="Client" IsEnabled="False" Tag="{x:Bind reminders:RemindersFilter.Client}"/>
            <SelectorBarItem Text="Date" IsEnabled="True" Tag="{x:Bind reminders:RemindersFilter.Date}"/>
        </SelectorBar>

        <Button Grid.Row="2" Grid.Column="2" Margin="8,4,8,0" 
                Style="{StaticResource SingleIconButtonStyle}"
                Click="Calendar_Click"
                ToolTipService.ToolTip="Open Calendar">
            <FontIcon Glyph="&#xF763;" Style="{StaticResource SingleIconFontStyle}"/>
        </Button>

        <!-- Reminders List -->
        <ScrollViewer Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="2">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <ItemsRepeater Grid.Row="0" ItemsSource="{x:Bind ViewModel.Filtered, Mode=OneWay}" HorizontalAlignment="Stretch">
                    <ItemsRepeater.ItemTemplate>
                        <DataTemplate x:DataType="models:Reminder">
                            
                            <!-- Split Button -->
                            <SplitButton Margin="8,6,8,0" Padding="14,10,14,10" Click="Reminder_Click"
                                         Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                         HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch"
                                         BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"
                                         Tag="{x:Bind Id}">
                                <Grid Opacity="{x:Bind Complete, Mode=OneWay, Converter={StaticResource BoolOpacityConverter}}">
                                    <Grid.RowDefinitions>
                                        <RowDefinition />
                                        <RowDefinition />
                                    </Grid.RowDefinitions>

                                    <Grid Grid.Row="0" Margin="0,0,0,6">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Grid.Column="0" FontSize="14" 
                                                   FontWeight="Bold" Text="{x:Bind ClientName, Mode=OneWay}"/>
                                        <TextBlock Grid.Column="1" FontSize="14" 
                                                   FontWeight="Normal" Text="{x:Bind LocalDate, Mode=OneWay}"/>
                                    </Grid>

                                    <TextBlock Grid.Row="1" Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                               FontWeight="Normal" TextWrapping="WrapWholeWords" 
                                               Text="{x:Bind Description, Mode=OneWay}"/>
                                </Grid>

                                <!-- Split Button Flyout -->
                                <SplitButton.Flyout>
                                    <MenuFlyout Placement="Right">
                                        <!-- Section 0: Completion / Goto Client -->
                                        <MenuFlyoutItem Text="{x:Bind Complete, Mode=OneWay, Converter={StaticResource BoolCompletedConverter}}" 
                                                        Click="ToggleCompleted_Click" Tag="{x:Bind Id}">
                                            <MenuFlyoutItem.Icon>
                                                <FontIcon Glyph="&#xF0B5;" Foreground="{ThemeResource AccentAAFillColorDefaultBrush}"/>
                                            </MenuFlyoutItem.Icon>
                                        </MenuFlyoutItem>
                                        <MenuFlyoutItem Text="Go To Client" Click="ViewClient_Click" Tag="{x:Bind ClientID}">
                                            <MenuFlyoutItem.Icon>
                                                <SymbolIcon Symbol="Contact" Foreground="{ThemeResource AccentAAFillColorDefaultBrush}"/>
                                            </MenuFlyoutItem.Icon>
                                        </MenuFlyoutItem>
                                        <MenuFlyoutSeparator/>
                                        
                                        <!-- Section 1: Defer Dates -->
                                        <MenuFlyoutItem Text="Defer 1 Day" CommandParameter="1" Click="Defer_Click" Tag="{x:Bind Id}"/>
                                        <MenuFlyoutItem Text="Defer 1 Week" CommandParameter="7" Click="Defer_Click" Tag="{x:Bind Id}"/>
                                        <MenuFlyoutItem Text="Defer 1 Month" CommandParameter="30" Click="Defer_Click" Tag="{x:Bind Id}"/>
                                        <MenuFlyoutSeparator/>
                                        <!-- Section 2: Delete -->
                                        <MenuFlyoutItem Text="Delete..." Click="Delete_Click" Tag="{x:Bind Id}">
                                            <MenuFlyoutItem.Icon>
                                                <SymbolIcon Symbol="Delete" Foreground="{ThemeResource SystemFillColorCriticalBrush}"/>
                                            </MenuFlyoutItem.Icon>
                                        </MenuFlyoutItem>
                                    </MenuFlyout>
                                </SplitButton.Flyout>
                            </SplitButton>
                        </DataTemplate>
                    </ItemsRepeater.ItemTemplate>
                </ItemsRepeater>
                <TextBlock Grid.Row="1" Margin="8,8,8,24" HorizontalAlignment="Center"
                           x:Name="EndTextField"
                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                           Text="{x:Bind ViewModel.EndText, Mode=OneWay}"/>
            </Grid>
        </ScrollViewer>
    </Grid>
</Page>
